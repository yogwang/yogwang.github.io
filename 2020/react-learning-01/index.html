<!DOCTYPE html>
<html lang="zh">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>「 ReactJS 笔记 」 L01 井字棋 | blog [ YOG WANG ]</title>
  <meta name="keywords" content="YogWang,blog,web-frontend" />
  <meta name="description" content="Here is my blog, my notes and some thoughts" />
  <meta name="author" content="YogWang" />
  <meta name="google-site-verification" content="C6xTGgRjDkU2yb8izJ39IyLjwUMbDpXiATd2a-WLg5U" />
  
  
<link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css">

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.3.0"></head>

  <body>
    <header id="header">
  <a class="header-sign" href="/">
    <img src="/favicon.png" alt="sign" />
    <span>YOG<br />WANG</span>
  </a>
  <nav class="header-navbar">
    
    <a class="nav-link" href="/archives">文章</a>
    
    <a class="nav-link" href="/about">我</a>
    
    <a class="nav-link" target="_blank" rel="noopener" href="https://github.com/yogwang">GitHub</a>
    
  </nav>
</header>

    <div id="wrap">
      <main id="container">
  <div
  id="post-react-learning-01"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
>
  <div class="article-inner">
    <div class="article-meta">
      <p class="article-date">
  <time datetime="2020-05-25T00:48:12.000Z" itemprop="datePublished">2020-05-25</time>
</p> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>
  </div>

    </div>
    
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      「 ReactJS 笔记 」 L01 井字棋
    </h1>
  

    </header>
    
    <div class="article-entry" itemprop="articleBody">
       
  <article class="article-content">
    <p>学习新东西的时候只看肯定是不够的, 所以既然 <code>ReactJS</code> 官方提供了一个<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/tutorial/tutorial.html">学习的案例</a>, 那么就一边写Demo, 一边读文档.</p>
<blockquote>
<p>Tips: 我是直接看案例然后按照自己的理解去写的, 并没有按照官方案例亦步亦趋, 所以可能流程会不一样.</p>
</blockquote>
<p>井字棋这个 demo 主要分为两部分: </p>
<h2 id="棋盘"><a href="#棋盘" class="headerlink" title="棋盘"></a>棋盘</h2><ul>
<li>点击棋盘空白格子可以落子, 落子之后交换棋手. </li>
<li>棋格已经落子 / 有棋手获胜时不可落子</li>
</ul>
<a id="more"></a>
<h2 id="游戏信息"><a href="#游戏信息" class="headerlink" title="游戏信息"></a>游戏信息</h2><ul>
<li>棋手信息<ul>
<li>提示当前落子的棋手信息</li>
<li>棋手获得胜利后, 显示胜利方</li>
</ul>
</li>
<li>对局历史记录<ul>
<li>展示对局历史信息</li>
<li>点击历史信息进行操作回溯</li>
</ul>
</li>
</ul>
<p>先从棋盘开始, 一共有9个格子, 每个格子有 3 个状态 (空, X, O)<br>我想到的就直接用 <code>flex</code> 布局了, 不需要考虑 <code>row</code> 和 <code>col</code>, 这样也可以直接用循环直接输出 9 个棋格, 同时也可以从循环里边取出棋格的状态</p>
<p>所以首先是造棋盘:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>; <span class="comment">// 引入 React 以及React下的 Component 类</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.styl&#x27;</span>; <span class="comment">// 引入样式文件</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 声明棋盘状态</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    squares: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>] <span class="comment">// 这里是棋盘9个格子的状态</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// </span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  * 当然你也可以使用 constructor,</span></span><br><span class="line"><span class="comment">  * 如果不理解 ES6 类的继承可以阅读 https://yogwang.github.io/2020/JS-class-constructor/</span></span><br><span class="line"><span class="comment">  constructor()&#123;</span></span><br><span class="line"><span class="comment">    super()</span></span><br><span class="line"><span class="comment">    this.state=&#123;</span></span><br><span class="line"><span class="comment">      squares: [0, 1, 2, 3, 4, 5, 6, 7, 8]</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-bar&#x27;</span>&gt;</span><br><span class="line">          <span class="comment">// 棋盘</span></span><br><span class="line">          &lt;div className=<span class="string">&#x27;board&#x27;</span>&gt;</span><br><span class="line">            <span class="comment">// 循环遍历棋格状态 并且返回单元格, 记得添加key, 这点于Vue一样</span></span><br><span class="line">            &#123;squares.map(<span class="function">(<span class="params">info, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;div className=<span class="string">&#x27;square&#x27;</span> key=&#123;index&#125;&gt;&#123;info&#125;&lt;/div&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>样式这边我用的预编译是 <code>Stylus</code>, 省略了括号, 冒号以及分号, 其它和 <code>SCSS</code> 基本一样.<br>如果不了解大概看一下就行</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.styl</span></span><br><span class="line"><span class="variable">$square</span> = <span class="number">60px</span> <span class="comment">/* 定义一个格子的宽度 */</span></span><br><span class="line"><span class="comment">// 棋盘样式</span></span><br><span class="line">.board</span><br><span class="line">  <span class="attribute">width</span> <span class="variable">$square</span> * <span class="number">3</span> <span class="comment">/* 一行3个格子的宽度 */</span></span><br><span class="line">  <span class="attribute">border</span> <span class="number">1px</span> solid black</span><br><span class="line">  <span class="attribute">display</span> flex <span class="comment">/* flex 布局 */</span></span><br><span class="line">  <span class="attribute">flex-wrap</span> wrap <span class="comment">/* 超出宽度可换行 */</span></span><br><span class="line"><span class="comment">// 棋格样式</span></span><br><span class="line">.square</span><br><span class="line">  <span class="attribute">width</span> <span class="variable">$square</span></span><br><span class="line">  <span class="attribute">height</span> @width <span class="comment">/* 高度同宽度 */</span></span><br><span class="line">  <span class="attribute">line-height</span> @height <span class="comment">/* 文字行高同容器高度 这里应该要减去 border 的高度, 但是不碍事 */</span></span><br><span class="line">  <span class="attribute">font-size</span> <span class="number">25px</span></span><br><span class="line">  <span class="attribute">text-align</span> center</span><br><span class="line">  <span class="attribute">border</span> <span class="number">1px</span> solid black</span><br><span class="line">  <span class="attribute">box-sizing</span> border-box <span class="comment">/* 修改盒模型 */</span></span><br><span class="line">  <span class="attribute">cursor</span> pointer</span><br></pre></td></tr></table></figure>
<p>完成之后大概是这样的一个样子</p>
<p><img src="/2020/react-learning-01/board.jpg" alt="棋盘"></p>
<p>然后是游戏信息的展示, 因为是交替落子, 所以单数步数是 棋手X 落子的话, 双数步数就一定是 棋手O 落子.<br>顺便给棋格绑定上点击事件, 棋盘的组件大概可以这样初步完成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.styl&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    squares: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">    step:<span class="number">0</span>, <span class="comment">// 增加计步器</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取当前Player</span></span><br><span class="line">  getCurPlayer () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; step &#125; = <span class="built_in">this</span>.state <span class="comment">// 获取当前步数</span></span><br><span class="line">    <span class="keyword">return</span> step % <span class="number">2</span> ? <span class="string">&quot;O&quot;</span> : <span class="string">&quot;X&quot;</span> <span class="comment">// 按照步数奇偶返回棋手</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 方块被点击</span></span><br><span class="line">  handleSquareClick (position, player) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, step &#125; = <span class="built_in">this</span>.state <span class="comment">// 获取当前棋盘信息以及步数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 既然获取到了棋格信息那么就顺便输出一下当前信息</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`当前步数: <span class="subst">$&#123;step&#125;</span>, 棋手: <span class="subst">$&#123;player&#125;</span>, 点击位置: <span class="subst">$&#123;position&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newStep = step + <span class="number">1</span> <span class="comment">// 步数 +1</span></span><br><span class="line">    <span class="keyword">const</span> newSquares = squares</span><br><span class="line">    newSquares[position] = player <span class="comment">// 修改对应棋格信息</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改State, 并且触发渲染</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      squares: newSquares, </span><br><span class="line">      step: newStep</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> player = <span class="built_in">this</span>.getCurPlayer()</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-bar&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;board&#x27;</span>&gt;</span><br><span class="line">            &#123;squares.map(<span class="function">(<span class="params">info, index</span>) =&gt;</span> (</span><br><span class="line">              <span class="comment">/*</span></span><br><span class="line"><span class="comment">              * 增加onClick事件, 这里和Vue不一样, 需要使用箭头函数, 或者使用 .bind(this) 绑定this</span></span><br><span class="line"><span class="comment">              * 具体原因请看上一篇 [React L00 起步]</span></span><br><span class="line"><span class="comment">              */</span></span><br><span class="line">              &lt;div className=<span class="string">&#x27;square&#x27;</span> key=&#123;index&#125; onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.handleSquareClick(index,player)&#125;&gt;&#123;info&#125;&lt;/div&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-info&#x27;</span>&gt;</span><br><span class="line">          <span class="comment">// 棋手信息</span></span><br><span class="line">          &lt;div className=<span class="string">&#x27;player-info&#x27;</span>&gt;Current player: &#123;player&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.styl</span></span><br><span class="line"><span class="comment">// ...接上一部分样式</span></span><br><span class="line">.game-info</span><br><span class="line">  <span class="attribute">width</span> <span class="number">400px</span></span><br><span class="line">  <span class="attribute">height</span> <span class="number">600px</span></span><br><span class="line">  <span class="attribute">max-height</span> <span class="number">100vh</span></span><br><span class="line">  <span class="attribute">margin-left</span> <span class="number">60px</span></span><br><span class="line">.player-info</span><br><span class="line">  <span class="attribute">font-size</span> <span class="number">22px</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/react-learning-01/board+playerinfo.jpg" alt="棋盘落子以及棋手信息"></p>
<p>现在棋盘可以被修改了, 棋手信息也有了, 同样也可以获取到每次操作的落子信息.</p>
<p>那么就可以先把历史记录加上, 并且展示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.styl&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    squares: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">    step:<span class="number">0</span>,</span><br><span class="line">    history:[], <span class="comment">// 增加历史记录</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取当前Player</span></span><br><span class="line">  getCurPlayer () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; step &#125; = <span class="built_in">this</span>.state </span><br><span class="line">    <span class="keyword">return</span> step % <span class="number">2</span> ? <span class="string">&quot;O&quot;</span> : <span class="string">&quot;X&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 方块被点击</span></span><br><span class="line">  handleSquareClick (position, player) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, step, history &#125; = <span class="built_in">this</span>.state </span><br><span class="line">    <span class="keyword">const</span> newStep = step + <span class="number">1</span></span><br><span class="line">    <span class="keyword">const</span> newSquares = squares</span><br><span class="line">    newSquares[position] = player</span><br><span class="line">    <span class="keyword">const</span> newHistory = history.concat([&#123;</span><br><span class="line">      step:step,</span><br><span class="line">      player:player,</span><br><span class="line">      position:position</span><br><span class="line">    &#125;])</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      squares: newSquares, </span><br><span class="line">      step: newStep,</span><br><span class="line">      history: newHistory</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares,history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> player = <span class="built_in">this</span>.getCurPlayer()</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-bar&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;board&#x27;</span>&gt;</span><br><span class="line">            &#123;squares.map(<span class="function">(<span class="params">info, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;div className=<span class="string">&#x27;square&#x27;</span> key=&#123;index&#125; onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.handleSquareClick(index,player)&#125;&gt;&#123;info&#125;&lt;/div&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-info&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;player-info&#x27;</span>&gt;Current player: &#123;player&#125;&lt;/div&gt;</span><br><span class="line">          <span class="comment">// 历史信息</span></span><br><span class="line">          &lt;ol className=<span class="string">&#x27;history&#x27;</span>&gt;</span><br><span class="line">            <span class="comment">// 遍历循环历史信息记录</span></span><br><span class="line">            &#123;history.map(<span class="function">(<span class="params">record, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;li key=&#123;index&#125;&gt;Player_&#123;record.player&#125; to &#123;record.position&#125;&lt;/li&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/ol&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>现在的游戏界面应该如下<br><img src="/2020/react-learning-01/history.jpg" alt="添加并展示历史记录"></p>
<p>这个时候呢, 就会有几个问题:</p>
<ul>
<li>棋格可以重复落子</li>
<li>没有获胜判断</li>
<li>棋盘默认显示数字, 很不美观</li>
</ul>
<p><em>其实还有一个问题, 在历史回溯的时候会很麻烦, 这个我实在游戏基本都完成了之后才发现的. 这个之后再说</em></p>
<p>所以在落子的时候增加<strong>当前棋格不为空</strong> 的判断, 并且以 <code>null</code> 填充数组;</p>
<p>代码修改如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.styl&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    squares: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>), <span class="comment">// 创建一个长度为 9 的数组,并且填充 null</span></span><br><span class="line">    step:<span class="number">0</span>,</span><br><span class="line">    history:[],</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取当前Player</span></span><br><span class="line">  getCurPlayer () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; step &#125; = <span class="built_in">this</span>.state </span><br><span class="line">    <span class="keyword">return</span> step % <span class="number">2</span> ? <span class="string">&quot;O&quot;</span> : <span class="string">&quot;X&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 方块被点击</span></span><br><span class="line">  handleSquareClick (position, player) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, step, history &#125; = <span class="built_in">this</span>.state </span><br><span class="line">    <span class="keyword">if</span> (squares[position]) <span class="keyword">return</span> <span class="comment">// 增加棋格不会空的判断</span></span><br><span class="line">    <span class="keyword">const</span> newStep = step + <span class="number">1</span></span><br><span class="line">    <span class="keyword">const</span> newSquares = squares</span><br><span class="line">    newSquares[position] = player</span><br><span class="line">    <span class="keyword">const</span> newHistory = history.concat([&#123;</span><br><span class="line">      step:step,</span><br><span class="line">      player:player,</span><br><span class="line">      position:position</span><br><span class="line">    &#125;])</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      squares: newSquares, </span><br><span class="line">      step: newStep,</span><br><span class="line">      history: newHistory</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> player = <span class="built_in">this</span>.getCurPlayer()</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-bar&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;board&#x27;</span>&gt;</span><br><span class="line">            &#123;squares.map(<span class="function">(<span class="params">info, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;div className=<span class="string">&#x27;square&#x27;</span> key=&#123;index&#125; onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.handleSquareClick(index,player)&#125;&gt;&#123;info&#125;&lt;/div&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-info&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;player-info&#x27;</span>&gt;Current player: &#123;player&#125;&lt;/div&gt;</span><br><span class="line">          <span class="comment">// 历史信息</span></span><br><span class="line">          &lt;ol className=<span class="string">&#x27;history&#x27;</span>&gt;</span><br><span class="line">            <span class="comment">// 遍历循环历史信息记录</span></span><br><span class="line">            &#123;history.map(<span class="function">(<span class="params">record, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;li key=&#123;index&#125;&gt;Player_&#123;record.player&#125; to &#123;record.position&#125;&lt;/li&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/ol&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/react-learning-01/isNull.jpg" alt="添加不为空判断"></p>
<p>好了, 棋盘的大致都完成了, 现在来写获胜判断.<br>因为我想者是每次循环一次所有棋格, 然后找出获胜的玩家, 但是这里循环有点傻,<br>所以我是看了一下官方的demo, 是这样的一个思路, 把所有的胜利条件都所列了出来, 然后去循环胜利条件, 如果所有胜利条件都循环结束, 没有出现胜利的玩家则继续游戏.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算赢家</span></span><br><span class="line">calculateWinner () &#123;</span><br><span class="line">  <span class="comment">// 获胜条件</span></span><br><span class="line">  <span class="keyword">const</span> lines = [</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">    [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>],</span><br><span class="line">    [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">const</span> &#123; squares &#125; = <span class="built_in">this</span>.state <span class="comment">// 取得所有棋盘数据</span></span><br><span class="line">  <span class="comment">// 循环判断胜利条件</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> [a, b, c] = lines[i]; <span class="comment">// 取出获胜坐标</span></span><br><span class="line">    <span class="comment">// 判断对应坐标是否有值 并且 三个坐标内的值是否相等</span></span><br><span class="line">    <span class="keyword">if</span> (squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a] === squares[c]) &#123;</span><br><span class="line">      <span class="keyword">return</span> squares[a]; <span class="comment">// 返回胜利者</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后补完一下棋盘, 胜利时在当前玩家信息提示获胜玩家.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.styl&#x27;</span>;</span><br><span class="line"><span class="comment">// 获胜条件</span></span><br><span class="line"><span class="keyword">const</span> lines = [</span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</span><br><span class="line">];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    squares: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">    step:<span class="number">0</span>,</span><br><span class="line">    history:[],</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取当前Player</span></span><br><span class="line">  getCurPlayer () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; step &#125; = <span class="built_in">this</span>.state </span><br><span class="line">    <span class="keyword">return</span> step % <span class="number">2</span> ? <span class="string">&quot;O&quot;</span> : <span class="string">&quot;X&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 方块被点击</span></span><br><span class="line">  handleSquareClick (position, player) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, step, history &#125; = <span class="built_in">this</span>.state </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.calculateWinner() || squares[position]) <span class="keyword">return</span> <span class="comment">// 增加是否有赢家的判断</span></span><br><span class="line">    <span class="keyword">const</span> newStep = step + <span class="number">1</span></span><br><span class="line">    <span class="keyword">const</span> newSquares = squares</span><br><span class="line">    newSquares[position] = player</span><br><span class="line">    <span class="keyword">const</span> newHistory = history.concat([&#123;</span><br><span class="line">      step:step,</span><br><span class="line">      player:player,</span><br><span class="line">      position:position</span><br><span class="line">    &#125;])</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      squares: newSquares, </span><br><span class="line">      step: newStep,</span><br><span class="line">      history: newHistory</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 计算赢家</span></span><br><span class="line">calculateWinner () &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; squares &#125; = <span class="built_in">this</span>.state </span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> [a, b, c] = lines[i]; </span><br><span class="line">    <span class="keyword">if</span> (squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a] === squares[c]) &#123;</span><br><span class="line">      <span class="keyword">return</span> squares[a];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares,history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> player = <span class="built_in">this</span>.getCurPlayer()</span><br><span class="line">    <span class="keyword">const</span> winner = <span class="built_in">this</span>.calculateWinner() <span class="comment">// 获取赢家</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-bar&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;board&#x27;</span>&gt;</span><br><span class="line">            &#123;squares.map(<span class="function">(<span class="params">info, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;div className=<span class="string">&#x27;square&#x27;</span> key=&#123;index&#125; onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.handleSquareClick(index,player)&#125;&gt;&#123;info&#125;&lt;/div&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-info&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;player-info&#x27;</span>&gt;</span><br><span class="line">            &#123;winner ? <span class="string">`Player_<span class="subst">$&#123;winner&#125;</span> is Winner!!!`</span> : <span class="string">`Current player: <span class="subst">$&#123;player&#125;</span>`</span>&#125;</span><br><span class="line">            <span class="comment">// 判断是否有玩家获胜, 如果有则输出获胜信息, 没有则输出当前玩家信息</span></span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;ol className=<span class="string">&#x27;history&#x27;</span>&gt;</span><br><span class="line">            &#123;history.map(<span class="function">(<span class="params">record, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;li key=&#123;index&#125;&gt;Player_&#123;record.player&#125; to &#123;record.position&#125;&lt;/li&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/ol&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>整个游戏流程到现在基本就完成了, 但是点击历史记录回溯操作的功能还没有加上来.<br>这个时候我就有点卡壳了, 不知道在当前逻辑下怎么回退操作. 就去看了官方的案例,<br>它是每一步在历史记录内插入当前棋盘数据, 然后回退的时候直接读取历史棋盘数据, 并且没有在历史记录中展示每一步的具体操作内容.</p>
<p>所以想了想还是继续原先的历史记录, 并且按照历史记录来生成棋盘数据(这边参考了<a target="_blank" rel="noopener" href="https://space.bilibili.com/390120104">山地人老师</a>的思路),<br>那这样的话, 就不需要手动去修改棋盘数据了, 只要调用一下生成棋盘的函数就可以了. 具体代码修改如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.styl&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> lines = [</span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</span><br><span class="line">];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    squares: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">    step: <span class="number">0</span>,</span><br><span class="line">    history: [],</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取当前Player</span></span><br><span class="line">  getCurPlayer () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; step &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> step % <span class="number">2</span> ? <span class="string">&quot;O&quot;</span> : <span class="string">&quot;X&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 方块被点击</span></span><br><span class="line">  handleSquareClick (position, player) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, step, history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.calculateWinner() || squares[position]) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">const</span> newStep = step + <span class="number">1</span></span><br><span class="line">    <span class="comment">// 移除了棋盘数据操作, </span></span><br><span class="line">    <span class="keyword">const</span> newHistory = [</span><br><span class="line">      ...history.slice(<span class="number">0</span>, step),</span><br><span class="line">      &#123;</span><br><span class="line">        step: step,</span><br><span class="line">        player: player,</span><br><span class="line">        position: position</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      step: newStep,</span><br><span class="line">      history: newHistory,</span><br><span class="line">      squares: <span class="built_in">this</span>.calculateSquares(newHistory, newStep), <span class="comment">// 调用 calculateSquares 产生数据</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 计算赢家</span></span><br><span class="line">  calculateWinner () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> [a, b, c] = lines[i];</span><br><span class="line">      <span class="keyword">if</span> (squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a] === squares[c]) &#123;</span><br><span class="line">        <span class="keyword">return</span> squares[a];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 生成棋盘数据</span></span><br><span class="line">  calculateSquares (history, step) &#123;</span><br><span class="line">    <span class="keyword">const</span> newSquares = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>) <span class="comment">// 创建空棋盘数组</span></span><br><span class="line">    <span class="comment">// 循环插入历史数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; step; i += <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> tempHistory = history[i]</span><br><span class="line">      newSquares[tempHistory.position] = tempHistory.player</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newSquares <span class="comment">// 返回棋盘数据</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 回退历史步骤</span></span><br><span class="line">  handleGoBack (step) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> tempHistory = history.slice(<span class="number">0</span>, step) <span class="comment">// 根据传入步数截取历史记录</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      step: step, <span class="comment">// 重设步数</span></span><br><span class="line">      squares: <span class="built_in">this</span>.calculateSquares(tempHistory, step), <span class="comment">// 生成棋盘数据</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> player = <span class="built_in">this</span>.getCurPlayer()</span><br><span class="line">    <span class="keyword">const</span> winner = <span class="built_in">this</span>.calculateWinner() </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-bar&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;board&#x27;</span>&gt;</span><br><span class="line">            &#123;squares.map(<span class="function">(<span class="params">info, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;div className=<span class="string">&#x27;square&#x27;</span> key=&#123;index&#125; onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.handleSquareClick(index, player)&#125;&gt;&#123;info&#125;&lt;/div&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-info&#x27;</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">&#x27;player-info&#x27;</span>&gt;</span><br><span class="line">            &#123;winner ? <span class="string">`Player_<span class="subst">$&#123;winner&#125;</span> is Winner!!!`</span> : <span class="string">`Current player: <span class="subst">$&#123;player&#125;</span>`</span>&#125;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;ol className=<span class="string">&#x27;history&#x27;</span>&gt;</span><br><span class="line">            &#123;history.map(<span class="function">(<span class="params">record, index</span>) =&gt;</span> (</span><br><span class="line">              &lt;li key=&#123;index&#125; onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.handleGoBack(record.step + <span class="number">1</span>)&#125;&gt;Player_&#123;record.player&#125; to &#123;record.position&#125;&lt;/li&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/ol&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>至此为止, 基本的游戏功能都完成了, 只不过整个项目都是写在一个文件中的, 并没有进行组件化操作.<br>你们可以自行决定怎么拆分, 也可以继续阅读下去.</p>
<hr>
<h2 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h2><p>我认为可以把棋盘和游戏信息展示进行拆分;</p>
<ul>
<li><p><strong>棋盘</strong><br>这部分我觉得单独一个组件就可以了, 不用继续分解了, 因为单个棋格就一个 <code>div</code> 元素 加上 <code>onClick</code> 事件, 组件化的结果并没有简化代码, 反而增加代码量和不方便阅读.</p>
</li>
<li><p><strong>游戏信息</strong><br>可以继续拆分成玩家信息和历史记录, 然后再对应组件内进行状态维护和样式的编辑.</p>
</li>
</ul>
<p>拆分后的 <code>App.js</code> 文件如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Board <span class="keyword">from</span> <span class="string">&#x27;./components/Board&#x27;</span></span><br><span class="line"><span class="keyword">import</span> GameInfo <span class="keyword">from</span> <span class="string">&#x27;./components/GameInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.styl&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获胜条件</span></span><br><span class="line"><span class="keyword">const</span> lines = [</span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>],</span><br><span class="line">  [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">  [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>],</span><br><span class="line">  [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">  [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>],</span><br><span class="line">];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 定义属性</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    squares: <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>),</span><br><span class="line">    player: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    history: [],</span><br><span class="line">    step: <span class="number">0</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 计算当前Player</span></span><br><span class="line">  getCurPlayer () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; step &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> step % <span class="number">2</span> ? <span class="string">&quot;O&quot;</span> : <span class="string">&quot;X&quot;</span> <span class="comment">// 能否被2整除</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 生成棋盘数据</span></span><br><span class="line">  calculateSquares (history, step) &#123;</span><br><span class="line">    <span class="comment">// 创建新数组</span></span><br><span class="line">    <span class="keyword">const</span> newSquares = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">9</span>).fill(<span class="literal">null</span>)</span><br><span class="line">    <span class="comment">// 循环插入历史数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; step; i += <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> tempHistory = history[i]</span><br><span class="line">      newSquares[tempHistory.position] = tempHistory.player</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newSquares</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 计算赢家</span></span><br><span class="line">  calculateWinner () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="comment">// 循环判断胜利条件</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; lines.length; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> [a, b, c] = lines[i];</span><br><span class="line">      <span class="keyword">if</span> (squares[a] &amp;&amp; squares[a] === squares[b] &amp;&amp; squares[a] === squares[c]) &#123;</span><br><span class="line">        <span class="keyword">return</span> squares[a];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 方块被点击</span></span><br><span class="line">  handleSquareClick (position, player) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, step, history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="comment">// 如果已经获胜或棋格不为空则跳出</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.calculateWinner() || squares[position]) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">const</span> newStep = step + <span class="number">1</span> <span class="comment">// 新步数</span></span><br><span class="line">    <span class="comment">// 插入新历史记录</span></span><br><span class="line">    <span class="keyword">const</span> newHistory = [</span><br><span class="line">      ...history.slice(<span class="number">0</span>, step),</span><br><span class="line">      &#123;</span><br><span class="line">        step: step,</span><br><span class="line">        player: player,</span><br><span class="line">        position: position</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      step: newStep,</span><br><span class="line">      history: newHistory,</span><br><span class="line">      squares: <span class="built_in">this</span>.calculateSquares(newHistory, newStep), <span class="comment">// 生成棋盘数据</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 回退历史步骤</span></span><br><span class="line">  handleGoBack (step = <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> tempHistory = history.slice(<span class="number">0</span>, step)</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      step: step,</span><br><span class="line">      squares: <span class="built_in">this</span>.calculateSquares(tempHistory, step), <span class="comment">// 生成棋盘数据</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 重新开始</span></span><br><span class="line">  handleRestart () &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      history: []</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">this</span>.handleGoBack()</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares, history &#125; = <span class="built_in">this</span>.state</span><br><span class="line">    <span class="keyword">const</span> player = <span class="built_in">this</span>.getCurPlayer()</span><br><span class="line">    <span class="keyword">const</span> winner = <span class="built_in">this</span>.calculateWinner()</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div id=<span class="string">&#x27;app&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;game-bar&#x27;</span>&gt;</span><br><span class="line">          &lt;Board squares=&#123;squares&#125; onClick=&#123;<span class="function"><span class="params">i</span> =&gt;</span> <span class="built_in">this</span>.handleSquareClick(i, player)&#125; /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;GameInfo</span><br><span class="line">          player=&#123;player&#125;</span><br><span class="line">          winner=&#123;winner&#125;</span><br><span class="line">          history=&#123;history&#125;</span><br><span class="line">          goBack=&#123;<span class="function"><span class="params">step</span> =&gt;</span> <span class="built_in">this</span>.handleGoBack(step)&#125; /&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="棋盘组件"><a href="#棋盘组件" class="headerlink" title="棋盘组件"></a>棋盘组件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Board.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./Board.styl&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Board</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 生成棋格</span></span><br><span class="line">  renderSquare (status, index) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#x27;square&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.props.onClick(index)&#125; key=&#123;index&#125;&gt;&#123;status&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; squares &#125; = <span class="built_in">this</span>.props <span class="comment">// 获取棋盘数据</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&#x27;board&#x27;</span>&gt;</span><br><span class="line">        <span class="comment">// 循环棋盘数据生成棋格</span></span><br><span class="line">        &#123;squares.map(<span class="function">(<span class="params">status, index</span>) =&gt;</span> <span class="built_in">this</span>.renderSquare(status, index))&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Board</span><br></pre></td></tr></table></figure>
<h3 id="游戏信息组件"><a href="#游戏信息组件" class="headerlink" title="游戏信息组件"></a>游戏信息组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GameInfo.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> History <span class="keyword">from</span> <span class="string">&#x27;./History&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameInfo</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; player, winner, history &#125; = <span class="built_in">this</span>.props <span class="comment">// 从父组件获取棋手, 胜利方, 历史记录数据</span></span><br><span class="line">    <span class="comment">// 当前棋手信息, 如果已经有棋手胜利 返回胜利信息</span></span><br><span class="line">    <span class="keyword">const</span> playerInfo = winner ? <span class="string">`Player_<span class="subst">$&#123;winner&#125;</span> is Winner!!!`</span> : <span class="string">`Current player: <span class="subst">$&#123;player&#125;</span>`</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">&#x27;game-info&#x27;</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">&#x27;player-info&#x27;</span>&gt;&#123;playerInfo&#125;&lt;/div&gt;</span><br><span class="line">        &lt;History history=&#123;history&#125; onClick=&#123;<span class="function"><span class="params">step</span> =&gt;</span> <span class="built_in">this</span>.props.goBack(step)&#125;&gt;&lt;/History&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> GameInfo</span><br></pre></td></tr></table></figure>
<h4 id="操作历史组件"><a href="#操作历史组件" class="headerlink" title="操作历史组件"></a>操作历史组件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// History.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Record <span class="keyword">from</span> <span class="string">&#x27;./Record&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./History.styl&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">History</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; history &#125; = <span class="built_in">this</span>.props</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ol className=<span class="string">&#x27;history&#x27;</span>&gt;</span><br><span class="line">        &lt;li onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.props.onClick(<span class="number">0</span>)&#125;&gt;Go to game start&lt;<span class="regexp">/li&gt; /</span><span class="regexp">/ 回到游戏开始</span></span><br><span class="line"><span class="regexp">        &#123;</span></span><br><span class="line"><span class="regexp">          history.map((record, index) =&gt; (</span></span><br><span class="line"><span class="regexp">            &lt;Record info=&#123;record&#125; key=&#123;index&#125; onClick=&#123;() =&gt; this.props.onClick(record.step + 1)&#125;&gt;&lt;/</span>Record&gt;</span><br><span class="line">          ))</span><br><span class="line">        &#125;</span><br><span class="line">      &lt;/ol&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> History</span><br></pre></td></tr></table></figure>
<h4 id="单条历史记录"><a href="#单条历史记录" class="headerlink" title="单条历史记录"></a>单条历史记录</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Record</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 计算坐标 返回二维坐标 [0,0]</span></span><br><span class="line">  calculatePosition (position) &#123;</span><br><span class="line">    <span class="keyword">const</span> posY = (position / <span class="number">3</span> &gt;&gt; <span class="number">0</span>) + <span class="number">1</span> <span class="comment">// 取行号</span></span><br><span class="line">    <span class="keyword">const</span> posX = position % <span class="number">3</span> + <span class="number">1</span> <span class="comment">// 取列号</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`[<span class="subst">$&#123;posY&#125;</span>,<span class="subst">$&#123;posX&#125;</span>]`</span></span><br><span class="line">  &#125;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; info &#125; = <span class="built_in">this</span>.props <span class="comment">// 继承历史记录</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;li onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">this</span>.props.onClick()&#125;&gt;</span><br><span class="line">        Player_&#123;info.player&#125; to &#123;<span class="built_in">this</span>.calculatePosition(info.position)&#125;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Record</span><br></pre></td></tr></table></figure>
<p>样式文件如下:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.styl</span></span><br><span class="line">body</span><br><span class="line">  <span class="attribute">font-family</span> consolas</span><br><span class="line">  <span class="attribute">margin</span> <span class="number">0</span></span><br><span class="line">#app</span><br><span class="line">  <span class="attribute">width</span> <span class="number">100vw</span></span><br><span class="line">  <span class="attribute">height</span> <span class="number">100vh</span></span><br><span class="line">  <span class="attribute">display</span> flex</span><br><span class="line">  <span class="attribute">justify-content</span> center</span><br><span class="line">  <span class="attribute">align-items</span> center</span><br><span class="line">.game-bar</span><br><span class="line">  <span class="attribute">height</span> <span class="number">600px</span></span><br><span class="line">  <span class="attribute">max-height</span> <span class="number">100vh</span></span><br><span class="line">.game-info</span><br><span class="line">  <span class="attribute">width</span> <span class="number">400px</span></span><br><span class="line">  <span class="attribute">height</span> <span class="number">600px</span></span><br><span class="line">  <span class="attribute">max-height</span> <span class="number">100vh</span></span><br><span class="line">.player-info</span><br><span class="line">  <span class="attribute">font-size</span> <span class="number">22px</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Board.styl</span></span><br><span class="line"><span class="variable">$square</span> = <span class="number">60px</span></span><br><span class="line">.board</span><br><span class="line">  <span class="attribute">width</span> <span class="variable">$square</span> * <span class="number">3</span></span><br><span class="line">  <span class="attribute">border</span> <span class="number">1px</span> solid black</span><br><span class="line">  <span class="attribute">margin-right</span> <span class="number">50px</span></span><br><span class="line">  <span class="attribute">display</span> flex</span><br><span class="line">  <span class="attribute">flex-wrap</span> wrap</span><br><span class="line">.square</span><br><span class="line">  <span class="attribute">width</span> <span class="variable">$square</span></span><br><span class="line">  <span class="attribute">height</span> <span class="variable">$square</span></span><br><span class="line">  <span class="attribute">line-height</span> @height</span><br><span class="line">  <span class="attribute">font-size</span> <span class="number">25px</span></span><br><span class="line">  <span class="attribute">text-align</span> center</span><br><span class="line">  <span class="attribute">border</span> <span class="number">1px</span> solid black</span><br><span class="line">  <span class="attribute">box-sizing</span> border-box</span><br><span class="line">  <span class="attribute">cursor</span> pointer</span><br><span class="line">  &amp;:hover</span><br><span class="line">    <span class="attribute">background</span> <span class="number">#ddd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// History.styl</span></span><br><span class="line">.history</span><br><span class="line">  <span class="attribute">padding</span> <span class="number">0</span></span><br><span class="line">  <span class="attribute">counter-reset</span> number -<span class="number">1</span></span><br><span class="line">  li</span><br><span class="line">    <span class="attribute">margin</span> <span class="number">5px</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">counter-increment</span> number</span><br><span class="line">    <span class="attribute">list-style-type</span> none</span><br><span class="line">    <span class="attribute">cursor</span> pointer</span><br><span class="line">    &amp;:before</span><br><span class="line">      <span class="attribute">content</span> counter(number) <span class="string">&#x27;.&#x27;</span></span><br><span class="line">      <span class="attribute">margin-right</span> <span class="number">10px</span></span><br><span class="line">      <span class="attribute">display</span> inline-bloack</span><br><span class="line">    &amp;:hover</span><br><span class="line">      <span class="attribute">color</span> red</span><br><span class="line">      <span class="attribute">text-decoration</span> underline</span><br></pre></td></tr></table></figure>
<p><img src="/2020/react-learning-01/done.jpg" alt="完善后棋盘"></p>
<p>以上</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>一些卡壳的地方</p>
<ul>
<li>如何创建 <code>State</code> 状态</li>
<li><code>Constructor</code> 是怎么一回事</li>
<li>组件化后子组件如何触发父组件事件</li>
<li>为何 <code>onClick</code> 中的事件会自动执行</li>
<li>React中怎么使用 <code>Stylus</code></li>
<li>组件多层嵌套的情况下怎么获取其它的属性状态，类似 <code>Vuex</code> 的Store</li>
</ul>
 
  </article>


    </div>
  </div>
   
<nav id="article-nav">
  
    <a href="/2020/JS-class-constructor/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">newer</strong>
      <div class="article-nav-title">
        
          关于 ES6 Class 继承中 Constructor 的整理
        
      </div>
    </a>
  
  
    <a href="/2020/react-learning-00/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <div class="article-nav-title">「 ReactJS 笔记 」 L00 起步</div>
    </a>
  
</nav>
 
</div>



</main>
<aside id="sidebar">
  
    
<section class="userinfo">
    <img src="/img/userimg.jpg" alt="王阳阳">
    <h2>王阳阳</h2>
    <span>久之须自见得</span>
    <p>ODIN.INC</p>
    <p>Jiaxing,China</p>
    <div>
      
      <a class='fa fa-github' href="https://github.com/yogwang" target="_blank"></a>
      
      <a class='fa fa-weibo' href="http://weibo.com/yooooooge" target="_blank"></a>
      
    </div>
</section>

  
    
  <section class="widget-wrap">
    <h3 class="widget-title">recent_posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/jirengu-share-my-life-88th/">程序员社群 成长&amp;生活分享 2021/03/18</a>
          </li>
        
          <li>
            <a href="/2021/summary-at-the-end-of-2020/">回顾 史无前例的2020</a>
          </li>
        
          <li>
            <a href="/2021/about-emotional-blackmail/">关于情感勒索与关系依存自尊者</a>
          </li>
        
          <li>
            <a href="/2020/design-pattern-learning-L00/">「 设计模式学习 」 L00 开坑贴 &amp; 设计模式概览</a>
          </li>
        
          <li>
            <a href="/2020/JS-type-and-status-management-dictionary/">项目中的类型和状态管理</a>
          </li>
        
      </ul>
    </div>
  </section>

  
    
  <section class="widget-wrap">
    <h3 class="widget-title">archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li></ul>
    </div>
  </section>


  
    
  <section class="widget-wrap">
    <h3 class="widget-title">tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ant-Design-Vue/" rel="tag">Ant-Design-Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/" rel="tag">Apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Axios/" rel="tag">Axios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BetterScrol-js/" rel="tag">BetterScrol.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/" rel="tag">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Caddy/" rel="tag">Caddy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Canvas/" rel="tag">Canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chrome/" rel="tag">Chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Coding/" rel="tag">Coding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DigitalOcean/" rel="tag">DigitalOcean</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-6/" rel="tag">ECMAScript 6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ESlint/" rel="tag">ESlint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Electron/" rel="tag">Electron</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github/" rel="tag">Github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jeecg-boot/" rel="tag">Jeecg-boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NVM/" rel="tag">NVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node-js/" rel="tag">Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHPOK/" rel="tag">PHPOK</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RaspberryPi/" rel="tag">RaspberryPi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactJS/" rel="tag">ReactJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Server/" rel="tag">Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Three-js/" rel="tag">Three.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/" rel="tag">TypeScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-Router/" rel="tag">Vue-Router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VueJS/" rel="tag">VueJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebSocket/" rel="tag">WebSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WordPress/" rel="tag">WordPress</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tinyMCE/" rel="tag">tinyMCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B4%E4%BC%9A%E5%BC%80%E5%8F%91%E6%97%A5%E8%AE%B0/" rel="tag">年会开发日记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%83%85%E6%84%9F/" rel="tag">情感</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%96%E5%9D%91/" rel="tag">挖坑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%AA%E5%AE%8C%E6%88%90/" rel="tag">未完成</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A4%BE%E7%BE%A4%E5%88%86%E4%BA%AB/" rel="tag">社群分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AE%E9%A2%98/" rel="tag">问题</a></li></ul>
    </div>
  </section>


  
</aside>
    </div>
    <footer id="footer">
  <span>
    &copy;2019-2021 YogWang powered_by
    <a href="http://hexo.io/" target="_blank">Hexo</a>
  </span>
  <br />
  <span
    >licensed
    <a href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank"
      >CC BY-NC 4.0</a
    ></span
  >
</footer>
<div>
  <a id="gotop" class="fa fa-level-up"></a>
</div>

<script src="https://unpkg.com/jquery@3.4.1/dist/jquery.js"></script>
 
<script src="/js/common.js"></script>


  </body>
</html>
